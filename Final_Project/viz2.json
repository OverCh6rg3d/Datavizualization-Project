{
	"$schema": "https://vega.github.io/schema/vega-lite/v6.json",
	"data": {
		"url": "https://raw.githubusercontent.com/OverCh6rg3d/Datavizualization-Project/refs/heads/main/data/Accidents.csv"
	},
	"transform": [
		{
			"calculate": "timeParse(datum.acci_time, '%d/%m/%Y %H:%M')",
			"as": "parsed_date"
		},
		{
			"calculate": "hours(datum.parsed_date)",
			"as": "hour_of_day"
		},
		{
			"calculate": "day(datum.parsed_date) == 0 || day(datum.parsed_date) == 6 ? 'Weekend' : 'Weekday'",
			"as": "day_type"
		},
		{
			"timeUnit": "yearmonthdate",
			"field": "parsed_date",
			"as": "unique_date_identifier"
		},
		{
			"joinaggregate": [
				{
					"op": "distinct",
					"field": "unique_date_identifier",
					"as": "total_days_in_group"
				}
			],
			"groupby": ["day_type"]
		},
		{
			"calculate": "1 / datum.total_days_in_group",
			"as": "weighted_accident_count"
		}
	],
	"vconcat": [
		{
			"width": "container",
			"height": 300,
			"title": "Average Accidents per Hour: Weekday vs Weekend (Drag to Filter)",
			"mark": "line",
			"params": [
				{
					"name": "time_brush",
					"select": {"type": "interval", "encodings": ["x"]}
				}
			],
			"transform": [
				{"filter": {"param": "category_filter"}}
			],
			"encoding": {
				"x": {
					"field": "hour_of_day",
					"type": "quantitative",
					"title": "Hour of Day (0-23)",
					"scale": {"domain": [0, 23]}
				},
				"y": {
					"field": "weighted_accident_count",
					"aggregate": "sum",
					"title": "Average Accidents",
					"type": "quantitative"
				},
				"color": {
					"field": "day_type",
					"type": "nominal",
					"title": "Day Type",
					"scale": {"scheme": "category10"},
					"legend": {
						"orient": "top-right",
						"titleFontSize": 12,
						"labelFontSize": 12,
						"symbolSize": 100
					}
				},
				"tooltip": [
					{"field": "hour_of_day", "title": "Hour"},
					{"field": "day_type", "title": "Type"},
					{
						"field": "weighted_accident_count",
						"aggregate": "sum",
						"title": "Avg Accidents",
						"format": ".2f"
					}
				]
			}
		},
		{
			"hconcat": [
				{
					"width": 350,
					"height": 300,
					"title": "Total Accidents by Category (Click to Filter Trend)",
					"mark": "bar",
					"params": [
						{
							"name": "category_filter",
							"select": {"type": "point", "fields": ["Category"]}
						}
					],
					"transform": [
						{"filter": {"param": "time_brush"}}
					],
					"encoding": {
						"y": {
							"field": "Category",
							"type": "nominal",
							"sort": "-x",
							"axis": {"labelLimit": 180}
						},
						"x": {
							"aggregate": "count",
							"title": "Total Count"
						},
						"color": {
							"condition": {
								"param": "category_filter",
								"field": "Category",
								"legend": null
							},
							"value": "lightgray"
						},
						"tooltip": [
							{"field": "Category"},
							{"aggregate": "count", "title": "Count"}
						]
					}
				},
				{
					"width": 300,
					"height": 300,
					"title": "Category Distribution",
					"mark": "arc",
					"params": [
						{
							"name": "category_filter",
							"select": {"type": "point", "fields": ["Category"]}
						}
					],
					"transform": [
						{"filter": {"param": "time_brush"}}
					],
					"encoding": {
						"theta": {
							"aggregate": "count",
							"stack": true
						},
						"color": {
							"field": "Category",
							"type": "nominal",
							"legend": {"title": "Accident Category"}
						},
						"opacity": {
							"condition": {
								"param": "category_filter",
								"value": 1
							},
							"value": 0.2
						},
						"tooltip": [
							{"field": "Category"},
							{"aggregate": "count", "title": "Count"}
						]
					}
				}
			]
		}
	],
	"config": {
		"view": {"stroke": "transparent"},
		"axis": {
			"grid": true,
			"labelFont": "ui-sans-serif, system-ui, sans-serif",
			"titleFont": "ui-sans-serif, system-ui, sans-serif"
		},
		"legend": {
			"labelFont": "ui-sans-serif, system-ui, sans-serif",
			"titleFont": "ui-sans-serif, system-ui, sans-serif"
		},
		"title": {
			"font": "ui-sans-serif, system-ui, sans-serif",
			"fontSize": 16
		}
	}
}